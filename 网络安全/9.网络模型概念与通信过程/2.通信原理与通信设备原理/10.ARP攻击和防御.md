
#### 攻击
- IP冲突
  - 发送一个ARP包，告诉所有的电脑（广播），我是 192.188.9.3，mac地址为23:24:25:26:27:28
  - 其他电脑收到后没有反应，但是当真正的 192.188.9.3 收到后，就与自己的IP冲突了（我才是192.188.9.3）
    - 没有什么影响，192.188.9.3 可以正常上网，但是会提示IP冲突
  - 如果攻击方一直发送ARP包，提示会一直出现
- ARP欺骗
  - 向某台电脑，一直发送ARP欺骗包
    - ARP是信任模式，只要接收到ARP包，就会更新缓存
  - 比如缓存中有一个 192.188.9.3  ---> 23:24:25:26:27:28
    - 如果此时有一个电脑，向这台电脑，发送ARP欺骗包 192.188.9.3  ---> 23:24:25:26:27:29
    - 此时缓存就会更新，流量就会流向 23:24:25:26:27:29，而不是流向 192.188.9.3
  - 需要一直发送ARP欺骗包，才能达到欺骗的效果
    - 正常情况下，发送ARP请求，真正的 192.188.9.3 也会发送一个 ARP应答包
    - 如果欺骗包先到，真正的包后到，就会覆盖，ARP恢复正常
    - 如果一直发送，欺骗包最终会替换真正的包，ARP欺骗效果达到
  - 如果欺骗的是一个虚假的mac地址，ping的时候，可能会通一下，之后就断掉了
    - 就是因为，真正的ARP应答包来临，替换了欺骗的ARP。但是由于欺骗包一直发送，后面就又被替换成虚假的了，所以后面又不通了
  - **一般ARP欺骗用来监听网关的流量**
    - 可以做成两边欺骗
    - 欺骗A，C是网关，欺骗网关，C是A
    - 这样，A上网，数据会流向C，然后C在发给网关。网关回包也会流向C，然后C在发个A
    - 本来上网是 A <---> 网关 的流程。现在变成了 A <---> C <---> 网关。所有的上网流量都会流向C，这样C就可以利用抓包把数据抓出来
      - C 还可以控制数据包的发送，比如：时不时少发一个包，或者修改数据
        - 本来A向网关发的是 123，可能网关收到的是 13 或者 345（不是原始数据了）

#### 防御
- 手动配置静态ARP缓存
  - arp -s 192.9.8.12 23:24:25:26:27:28
  - 缺点：
    - 缓存关机后消失，可以配置批处理文件，开机就执行
    - IP是DHCP动态分配的，也就是会发生变化，发生变化就需要重新配置，可以配置静态IP，但是过于麻烦

- ARP防火墙
  - 会自动写入，网关的ARP缓存，防止网关被更改（解决发包的时候被拦截）
  - 会一直向网关发送ARP应答包，防止网关被攻击（解决网关回包的时候被拦截）
    - C一直往网关发送ARP包，告诉网关我是A
    - A的ARP防火墙，也一直往网关发送ARP包，告诉网关我是A
    - 只要，ARP防火墙发送的ARP包，够快够多，就不会被C替换，这样网关回包，就不会发送到C，从而被C拦截。而是正确的流向A
  - 缺点：
    - 由于一直往网关发送ARP应答包，在公司环境下，电脑又多，网关的压力就非常大，会造成阻塞（都处理ARP包，正常包处理就会变慢）
    - 所以不适合使用


- 交换机防御
  - 依赖DHCP
    - ARP的作用就是把IP解析成mac地址。而每个电脑的IP都是DHCP自动分配的
  - 当电脑一连上网，就会发送DHCP广播，获取IP地址
    - 当电脑发送DHCP Request包的时候，IP就已经定了
    - 电脑发送包，会在帧头带上自己的MAC地址
    - 当DHCP Request包到达交换机的时候，交换机就会解析这个包，从而形成一个缓存
      - 比如：192.188.9.3  -->  23:24:25:26:27:28  -->  F3
      - 当这台电脑进行ARP攻击的时候，发送192.188.9.9  -->  23:24:25:26:27:29  -->  F3
        - 交换机一看，你这个端口的ARP和缓存不一样，就会认为这台电脑进行ARP攻击
        - 可以不进行理会，甚至交换机可以把这个端口关掉，这样这台电脑就无法上网，想要重新打开，需要找管理员，这样管理员就会知道你的电脑进行了ARP攻击
  - 如果是手动配置IP
    - 当电脑发送第一个包的时候，交换机一看没有缓存，就会创建缓存
      - 比如：192.188.9.3  -->  23:24:25:26:27:28  -->  F3
    - 如果第一包就伪造，进行ARP欺骗，那缓存的就是欺骗ARP，就会造成无法上网
      - 正确的ARP应答包，就发送不出去了，被交换机拦截（不一样，存的是假的）
      - 正确的发送不出去，网关回包的时候，就找不到这台电脑（没有192.188.9.3对应的mac地址），从而造成无法上网
  - 缺点
    - 交换机有额外的功能，所以价格贵
