
#### 作用
- 单臂路由（router-on-a-stick）是指在路由器的一个接口上通过配置子接口（或“逻辑接口”，并不存在真正物理接口）的方式，实现原来相互隔离的不同VLAN（虚拟局域网）之间的互联互通
- 就是一个路由器，模拟出多个网关，然后进行Vlan间通信



#### 通信流程（不同Vlan相互通信）
- 以一个实例为例
  <img src='https://lsz.net.cn/node/imgs/dbec11360510bfc9f97ee83bbb136445.png' />
  - 在路由器上创建了两个逻辑接口（假的），就相当于有两个接口，连接了两个网段，于是路由表中就有了两个直连路由
  - 即L1/10.2.3.0、L2/10.2.4.0
  - 每个组的网关要加到对应的Vlan组里，这样才能接收对应Vlan组里的数据包
- 10.2.3.2电脑要与10.2.4.2电脑通信（不在一个网段）
  - 虽然两个电脑，在同一个交换机下，但是采用Vlan分组，给他们附上了不同的网段
- 由于跨网段传输要用到路由器，而路由器与交换机只有一根线连着，并且是两个Vlan的数据都要通过，所以要把F5/F6设置成Trunk接口（上一章介绍）
- **通信流程**
  - 获取目标mac地址，V1电脑，一看是跨网段传输，于是获取网关的mac地址（10.2.3.244）,发送ARP（第一次没有缓存），ARP采用的是广播的形式
    - 由于广播是V1组发出的，而F5端口配置了Trunk，是可以通过这个接口把广播发到路由器上的
    - 由于接口是Trunk，所以要打上标记（标明是V1）
    - 路由器接到数据，发现是V1组里的数据，于是就发到了逻辑接口L1（即网关：10.2.3.244），顺利拿到网关的mac地址
    - 由于网关10.2.3.244是逻辑接口，所以获取的mac接口就是路由器的mac（网关10.2.4.244获取的mac地址也是这个）
  - 拿到网关的mac地址后，封装数据帧
  - 数据帧到达交换机，由于数据帧的目标mac地址就是路由器的，所以交换机会找到F5端口，顺着F5，顺利发到路由器
    - 由于F5是Trunk，并且这个包是V1发送的，于是F5会打上一个标记（标明是V1）
  - 数据到达路由器后，发现标记是V1，于是数据就会发送到逻辑接口L1，开始实行路由的功能
    - 发现目标IP是 10.2.4.2 而网段 10.2.4.0 属于直连网段，于是数据包顺利到达逻辑接口L2（即网关：10.2.4.244）
  - 数据到达逻辑接口L2（即网关：10.2.4.244）后，开始输出，先发送ARP获取10.2.4.2的mac地址，ARP采用的是广播的形式
    - 由于广播是V2组发出的（网关：10.2.4.244属于V2），到达F6端口，而F6端口配置了Trunk，所以要打上标记（标明是V2）
    - 广播到达F5（到达交换机），一看标记是V2
    - 所以广播只会广播V2，不会涉及V1，而10.2.4.2属于V2，所以可以接收到ARP广播，顺利返回自己的mac地址
  - 逻辑接口L2（即网关：10.2.4.244）得到mac地址后，开始封装数据帧，然后发出
  - 数据经过F6/F5到达交换机，交换机根据目标mac地址，顺利把数据发送到 10.2.4.2
  - 完成不同Vlan间的相互通信


#### 单臂路由已经被淘汰（替换品是三层交换机）
- 缺点
  - 网络瓶颈（所有的通信都走一条线）
  - 容易发生单点通信故障（所有的通信都走一条线，如果那条线的端口坏了，则无法通信）
  - Vlan间的通信都要进行单独路由（查询路由表，发送ARP，组装帧头），效率较低


#### 配置网关的方式（虚拟接口）
<img src='https://lsz.net.cn/node/imgs/b433914354d12419753ecd82027063df.png' />

- 所有逻辑端口都配置好了之后，最终要把真正的端口开启
  ```js
  int f0/0 
  no shut
  exit
  ```