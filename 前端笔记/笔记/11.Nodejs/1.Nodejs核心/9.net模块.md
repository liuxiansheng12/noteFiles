


#### net模块能干什么
1. `net`模块是一个通信模块
2. 利用`net`模块，可以实现。进程间的相互通信(被称为IPC)，也可以进行网络通信（是基于TCP/IP协议的，比http协议更高一级）
   1. TCP/IP 与 HTTP，之间的差异
      1. HTTP，是一次请求，返回一次数据，并且有格式的要求，有请求体、请求头、相应体、相应头
      2. TCP/IP没有这么多要求，建立起连接后，比较宽松，可以传递任何数据。并且也不是一次请求，对应一次响应
         1. 可以一次请求，没有相应，也可以有多个相应。也可以没有请求，服务端直接发送数据
      3. 这就是 `net` 模块，进行网络通信的特点


#### net模块，可以创建一个客户端，与服务端建立连接进行通信
1. 具体的实现方式: ` net.createConnection(配置对象，回掉函数)`，该方法返回一个 `socket`
2. 配置对象中主要有两个，重要的属性
   1. 一个是连接主机名: `host`，只是一个单纯的主机名，没有`http://`，其实就是域名 
      1. 比如: https://www.baidu.com，的主机名为 `www.baidu.com`
   2. 一个是连接的端口号: `port`，必须要写，没有默认值
3. 返回值 `socket` 的介绍
   1. 这是一个对象，与底层的一个 `socket` 文件建立连接，并且是一个双工流连接
   2. **发生数据和读取数据，是一个流，这种被称为双工流**
      1. 向流中写入内容，就会发送数据
      2. 读流中的内容，就是接受数据

4. 具体的示范代码
```js
const net = require('net');

// 创建一个连接
const socket = net.createConnection({
    // 指定将要连接的主机名
    host: 'www.baidu.com',
    port: 80
}, () => {
    console.log('连接建立成功');
})
// 打印下，socket双工流，是一个socket对象
// console.log(socket);

// 向双工流中写内容，发送数据。
socket.write('hello');

// 读取双工流中的数据，接受数据
socket.on('data', function (data) {
    // 流读取的都是Buffer数据，所以需要转化一下
    console.log('接受的数据:', data.toString('utf-8'));

    // 客户端手动，关闭连接
    socket.end();
})

socket.on('close', function (data) {
    console.log('连接已断开');
})
```


5. net甚至可以模拟 `http/ip` 协议
   1. 发送数据的时候，发送一个 `http/ip` 格式的数据，这样服务端拿到数据后
      1. 一分析，接受的字符串符合`HTTP/IP`协议，就会进行对应的处理
      2. 其实，`http/ip` 的 本质，就是，发送一个该协议约定好的字符串，给服务端。
      3. 服务端接受到这个字符串后，就会解析，根据 `http/ip` 规定的格式，一解析，发现符合。就会进行相应的处理
      4. 所以，只要把 `http/ip` 规定的字符串格式，发送给服务器，服务器就可以按照 `http/ip` 进行解析
   2. 而五层网络模型，`http/ip` 下面，就是 `TCP/IP`协议。所以，`http/ip` 这一层，就是按照 `http/ip` 规定的格式
      1. 包装数据，形成一次字符串，然后交给 `TCP/IP`
      2. 而使用 `TCP/IP` 直接发送 `http/ip` 格式的字符串，就是人为的完成了包装。
   3. 总结来说，`http/ip` 就是人自定义的一种请求格式，我们也可以自定义一种协议出来


6. **手动关闭链接，数据丢失的问题**
   1. 关闭链接的时候要注意，由于流是一段一段的发，也就是一段一段的相应
   2. 如果直接关闭链接，就有可能导致后面的数据还没有传递完，链接就关闭了，这样就会造成数据的丢失
   3. **一般的话，给出的相应，都是有一个相应头的**(人为规定的一种格式，就是字符串拼接，拼接上特殊格式的字符串，表示相应头)
   4. 在相应头上，有一个字段，用来表明，发送的数据的总字节数
   5. 这样的话，客户段，就可以获取到这个字段，判断接受的数据，是否接受完成，如果完成，在进行关闭，此时就没有数据的丢失问题






#### net模块，创建服务端
1. 通过 `net.createServer()` 创建一个服务，返回一个server对象
2. server对象中，有一个`listen`方法，设置的是监听一个端口
3. 常用的事件
   1. `listening`事件，当服务监听了某个端口后，该事件就会触发
   2. `connection`事件，有一个客户端与该服务器建立连接后，该事件就会触发
      1. 并且事件的回掉函数，接受一个 `socket` 对象，也就是双工流。
      2. 往双工流中写数据，就是发送数据。从双工流中读数据，就是获取客户端发送的数据
   3. **一个客户端，与该服务端建立连接，就会产生一个 `socket`，与之建立连接**
      1. 所以服务端，可以产生多个 `socket`，分别对应不同的客户端连接
4. **可以相应HTTP/IP的请求**
   1. 但是，响应需要符合 `HTTP/IP` 定义的格式，也就是特殊的字符串，有相应头
   2. 如果不是这个格式的字符串，虽然也可以发送，但是客户端不认识，无法处理

5. 服务，就是监听一个端口，请求就是连接一个端口。只要连接到服务器监听的端口，服务器就可以知道，然后进行处理
   1. 无论是使用什么搭建的服务器



#### net搭建的服务器，其实就是一个最底层的服务器
1. 而http/ip协议的服务器。其实，就是对发送的数据，**按照 http/ip 定义的规定进行包装**，其实也就是字符串的拼接
   1. 只不过字符串的拼接是，自动完成的
2. net搭建的服务器，要想处理 http/ip协议 的请求，**需要手动对数据进行字符串的拼接，拼接成符合 http/ip 格式的字符串**。
   1. 所以，net搭建的服务器，类似最底层的方式，类似源码
3. http/ip 格式的字符串，要有一个响应头，响应体，发送的数据。
   1. 并且，响应头，响应体中间有一个换行符
   2. 响应体，发送的数据中间有两个换行符
   3. **除此之外，每一行，连个制表符都不可以有(比如为了对齐，每一行敲几个制表符，这样是不可以的)**
   4. **开始和结束，也不能有换行符**
   5. **字符串的格式，可以从浏览器中，随便找一个响应，进行查看，但是只能查看到响应头的字符串样式**
      1. **数据的话，敲两个空格，把数据放在下面，就可以了**
      2. **也可以敲两个换行，数据单独发送**，下面的代码稍微介绍了下，分开发送的方式。
   6. 下面只是展示下格式，由于每一行存在制表符，是不可以的
    ```js
        const net = require('net');
        // 创建服务
        const server = net.createServer();
        server.listen(10086);
        // 监听链接
        server.on("connection", (socket) => {
            console.log('a');
            // 发送 HTTP/IP格式字符串
            socket.write(`HTTP/1.1 200 OK
        Content-Type: text/plain; charset=utf-8

        123`);
            // 甚至可以拆开来发，最后会合并，这样的话，就可以先发送一个响应头
            // 数据的话，动态获取，然后在进行发送，比如读一个文本，读一个图片，然后把读取的数据进行发送
            socket.write(`aaa`);
            // 发送完成后，就要关闭链接，HTTP/IP就是一次请求，对应一个响应，如果没有关闭，客户端是拿不到数据的
            socket.end();
        } )
    ```


   
#### 总结来说，网络通信就是数据间的传递
1. 为了便于管理，在发送数据的时候，加上一个标记（请求头、响应头），这样就构成了HTTP/Ip协议
2. 说白了，HTTP/IP协议，就是人为规定的一种格式。我们也可以自定义
   1. 比如：发送数据的时候，在前面加个  `STS/1.1 200 OK` ，规定这是一个 `STS` 协议
3. HTTP/IP协议，用的人多了，老是手写 `HTTP/IP` 的格式（上面有介绍），过于麻烦。于是就创造了一个HTTP模块
   1. 使用该模块，发送数据和接受数据，都会按照 `HTTP/IP` 规定的格式，拆分请求，或者拼接响应
   2. 形成一个新的字符串，进行发送，这样就不用手动构建了
   3. 模拟一下，**说白了，就是字符串的拼接**，只不过自动完成
   ```js
   const net = require('net');
   function http() {
      let server = null;
      return {
         // 创建服务的方法，接受具体的处理函数
         createServer(func) {
               server = net.createServer();
               server.on("connection", function (socket) {
                  const myResponse = {
                     write(data) {
                           // 自动对发送的数据，完成包装(字符串拼接)，变成 HTTP/IP格式的 
                           // 这样的话，每次就不用手写了
                           socket.write(`HTTP/1.1 200 OK\nContent-Type: text/plain; charset=utf-8\n\n`);
                           socket.write(data);
                     },
                     end() {
                           socket.end();
                     }
                  }
                  func(null, myResponse);
               })
               return this;
         },
         // 监听端口的方法
         listen(num) {
               server.listen(num);
         }
      }
   }


   // 创建服务
   const server = http().createServer((request, response) => {
      response.write('hello');
      response.end();
   });
   server.listen(10086);
   ```